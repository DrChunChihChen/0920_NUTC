import streamlit as st
import pandas as pd
import plotly.express as px

# --- 頁面設定 ---
st.set_page_config(
    page_title="原油進口趨勢分析",
    page_icon="🛢️",
    layout="wide"
)

# --- 標題 ---
st.title("🛢️ 台灣原油進口量趨勢圖")
st.markdown("#### 依國家/地區別分析 (2004-2024)")

# --- 資料載入 ---
# 根據您提供的圖片手動建立 DataFrame
data = {
    '西元年': [2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
    '原油進口量合計': [386866.2867, 381741.0166, 365361.6154, 360808.7503, 333142.8208, 343673.5233, 316677.0138, 290061.5623, 318420.0014, 295935.3661, 315220.045, 307700.8582, 313844.1596, 312217.0151, 322532.1633, 325232.4381, 270046.6405, 278852.63, 297443.8777, 295051.8815, 285211.0084],
    '沙烏地阿拉伯': [89294.38, 107270.9, 112515.8, 116395, 110774.4, 117341.7, 105778.9, 97930.93, 100233.4, 106058.2, 103892.5, 99264.53, 100111.7, 98215.03, 98636.57, 102085.2, 90099.07, 86706.13, 100837.8, 92129.83, 89379.16],
    '科威特': [81760.24, 88002.37, 77403.53, 73787.51, 74334.73, 69324.38, 71295.06, 66893.96, 67218.45, 64213.93, 59947.32, 67642.17, 66463.82, 61569.33, 68029.15, 63761.85, 54157.83, 60870.23, 63002.93, 52565.45, 37222.93],
    '美國': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2582.582, 43899.7, 59743.66, 53064.44, 53338.28, 60634.79, 79531.96, 83065.68],
    '阿拉伯聯合大公國': [14161.54, 17614.96, 23843.97, 21646.17, 16710.5, 15879.8, 15900.66, 17259.82, 21600.36, 18224.06, 29255.99, 26319.24, 18737.17, 30886.67, 27902.65, 36566.6, 25398.48, 29447.23, 24770.79, 23820.96, 29716.78],
    '伊拉克': [15380.8, 18180.96, 12798.08, 30226.33, 21182.63, 33745.71, 22941.84, 8224.258, 23999.3, 23264.2, 34501.12, 26893.97, 21686.2, 16262.34, 24393.3, 13606.73, 12622.5, 12702.61, 6754.266, 6785.901, 4817.182],
    '安哥拉': [21772.78, 18610.09, 27879.41, 28816.61, 19120.26, 19025.7, 30564.44, 52168, 43452.26, 33531.73, 26539.41, 24929.97, 28714.68, 25837.43, 3974.999, 2845.434, 10408.15, 3710.054, 8795.305, 1598.36, 1598],
    '阿曼': [12591.18, 15024.64, 12528.63, 9922.908, 9999.656, 17315.37, 14104.86, 4001.558, 33945.49, 26723.67, 32023.35, 38900.89, 24694.99, 19507.79, 21185.55, 20686.8, 9477.933, 14874.53, 20287.1, 23565.67, 23485.58],
    '查德': [0, 1899.376, 945.4978, 0, 952.467, 0, 0, 533.8474, 0, 417.5903, 0, 948.9518, 616.6742, 499.5915, 0, 0, 4020.074, 6648.459, 4767.568, 3801.519, 633.7134],
    '卡達': [9880.546, 5228.8317, 9805.074, 921.7892, 1968.308, 1123.797, 960.9328, 0, 1565.466, 577.9721, 2659.716, 3909.031, 0, 3042.78, 1049.027, 2931.184, 3924.617, 2449.188, 2998.442, 4903.268, 15840.43],
    '奈及利亞': [6774.598, 0, 945.1039, 2841.417, 0, 946.5841, 0, 4836.285, 1941.863, 0, 1862.385, 0, 946.0153, 4017.963, 995.959, 0, 2850.74, 3002.668, 1946.401, 0, 0],
    '其他': [126428, 105257.2, 86696.52, 76251.04, 78099.87, 68970.45, 55130.36, 38212.9, 24463.4, 22924.05, 24538.23, 18872.1, 51872.88, 49795.51, 32465.46, 22905.28, 4022.74, 5103.25, 2648.526, 6349.153, 1049.752],
}
df = pd.DataFrame(data)

# --- 側邊欄篩選器 ---
st.sidebar.header("篩選器")
# 取得所有可選擇的國家/地區欄位
# 排除 '西元年', '單位', '原油進口量合計'
country_options = [col for col in df.columns if col not in ['西元年', '單位', '原油進口量合計']]

selected_countries = st.sidebar.multiselect(
    "選擇要顯示的國家/地區",
    options=country_options,
    default=['沙烏地阿拉伯', '美國', '科威特', '阿拉伯聯合大公國'] # 預設選項
)

# --- 圖表繪製 ---
if selected_countries:
    # 建立一個只包含西元年和被選中地區的 DataFrame
    plot_df = df[['西元年'] + selected_countries]
    
    # 將 DataFrame 從寬格式轉換為長格式，以便 Plotly 繪圖
    df_melted = plot_df.melt(id_vars='西元年', var_name='國家/地區', value_name='進口量 (千桶)')
    
    # 使用 Plotly Express 建立互動式折線圖
    fig = px.line(
        df_melted,
        x='西元年',
        y='進口量 (千桶)',
        color='國家/地區',
        markers=True, # 顯示數據點
        title='各國家/地區原油進口量趨勢'
    )
    
    # 更新圖表樣式
    fig.update_layout(
        xaxis_title='年份',
        yaxis_title='進口量 (千桶)',
        legend_title='國家/地區'
    )
    
    # 在 Streamlit 中顯示圖表
    st.plotly_chart(fig, use_container_width=True)
    
    # --- 顯示原始數據 ---
    st.subheader("原始數據")
    st.dataframe(df, use_container_width=True)

else:
    st.warning("請在左側側邊欄中選擇至少一個國家/地區以顯示圖表。")
